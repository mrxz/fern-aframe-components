<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Fern A-Frame Components | Effekseer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrxz/effekseer-sample-effects/effekseer-build/effekseer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@zip.js/zip.js/dist/zip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dat.gui/build/dat.gui.min.js"></script>
    <script src="/js/aframe-effekseer.umd.min.js"></script>
    <script>
      AFRAME.registerComponent('effect-switcher', {
        schema: {
          effectEl: { type: 'selector', default: '#effect-container' },
          effectList: { type: 'asset', default: '#effect-list' }
        },
        init: function() {
          const effectList = THREE.Cache.get(this.data.effectList);
          const gui = new dat.GUI({name: "A-Frame Effekseer", });
          let effekseerComponent = this.data.effectEl.children[0].components.effekseer;
          const state = {
            effect: 'tktk02/Sword1.efkpkg',
            scale: 0.5,
            target: new THREE.Vector3(3, 1.5, -10),
            paused: false,
            reset: () => {
              effekseerComponent.stopEffect();
              effekseerComponent.playEffect();
            }
          }
          gui.add(state, "effect", effectList.effects)
            .listen().onChange((effectFile) => {
              const effectEntity = document.createElement('a-entity');
              effectEntity.setAttribute('effekseer', {
                src: `https://cdn.jsdelivr.net/gh/mrxz/effekseer-sample-effects/effects/${effectFile}`,
                loop: true
              });
              this.data.effectEl.append(effectEntity);
              effectEntity.addEventListener('loaded', e => {
                effekseerComponent = effectEntity.components.effekseer;
                effekseerComponent.setTargetLocation(state.target);
                state.paused = false;
                this.data.effectEl.children[0].remove();
              });
            });
          const transformGui = gui.addFolder("Transform");
          transformGui.open();
          transformGui.add(state, "scale", 0, 1).name("Scale")
            .listen().onChange((scale) => {
              this.data.effectEl.object3D.scale.set(scale, scale, scale);
            });
          transformGui.add(state.target, "x").name("Target X")
            .listen().onChange(_ => effekseerComponent.setTargetLocation(state.target));
          transformGui.add(state.target, "y").name("Target Y")
            .listen().onChange(_ => effekseerComponent.setTargetLocation(state.target));
          transformGui.add(state.target, "z").name("Target Z")
            .listen().onChange(_ => effekseerComponent.setTargetLocation(state.target));
          const actionGui = gui.addFolder("Actions");
          actionGui.open();
          actionGui.add(state, "paused").name("Paused").listen().onChange(pause => {
            if(pause) {
              effekseerComponent.pauseEffect();
            } else {
              effekseerComponent.resumeEffect();
            }
          });
          actionGui.add(state, "reset").name("Reset");
        }
      })
    </script>
  </head>
  <body>
    <a-scene effekseer="wasmPath: https://cdn.jsdelivr.net/gh/mrxz/effekseer-sample-effects/effekseer-build/effekseer.wasm" background="color: black" effect-switcher>
      <a-assets>
        <a-asset-item id="start-effect" src="https://cdn.jsdelivr.net/gh/mrxz/effekseer-sample-effects/effects/tktk02/Sword1.efkpkg" response-type="arraybuffer"></a-asset-item>
        <a-asset-item id="effect-list" src="https://cdn.jsdelivr.net/gh/mrxz/effekseer-sample-effects/effects/index.json" response-type="json"></a-asset-item>
      </a-assets>

      <a-entity id="effect-container" position="0 1.5 -10" scale="0.5 0.5 0.5">
        <a-entity effekseer="src: #start-effect; dynamic: true"></a-entity>
      </a-entity>
    </a-scene>

<a href="https://github.com/mrxz/fern-aframe-components/" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></a>  </body>
</html>