!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";AFRAME.registerPrimitive("a-hud",{defaultComponents:{hud:{}},mappings:{radius:"hud.radius","horizontal-fov":"hud.horizontalFov","vertical-fov":"hud.verticalFov","scale-factor":"hud.scaleFactor"}}),AFRAME.registerPrimitive("a-hud-element",{defaultComponents:{"hud-element":{}},mappings:{align:"hud-element.align",anchor:"hud-element.anchor","content-size":"hud-element.contentSize","hud-size":"hud-element.hudSize"}}),AFRAME.registerComponent("hud",{schema:{radius:{type:"number",default:1},horizontalFov:{type:"number",default:80},verticalFov:{type:"number",default:60},scaleFactor:{type:"number",default:1}},init:function(){this.flat=!0,this.el.sceneEl.addEventListener("rendererresize",(()=>{this.flat&&this.relayout()})),this.el.sceneEl.addEventListener("enter-vr",(()=>{this.flat=!1,this.relayout()})),this.el.sceneEl.addEventListener("exit-vr",(()=>{this.flat=!0,this.relayout()}))},relayout:function(){for(const t of this.el.children)t.components["hud-element"]&&t.components["hud-element"].layout(this)},convertCoordinates:function(t,e){if(this.flat){const n=this.el.sceneEl.camera,i=Math.tan(.5*THREE.MathUtils.DEG2RAD*n.fov)/n.zoom,a=i*n.aspect;e.set(t.x*a,t.y*i,-1)}else{const n=-this.data.horizontalFov/2*t.x,i=this.data.verticalFov/2*t.y-90;e.set(Math.sin(THREE.MathUtils.DEG2RAD*i)*Math.sin(THREE.MathUtils.DEG2RAD*n),Math.cos(THREE.MathUtils.DEG2RAD*i),Math.sin(THREE.MathUtils.DEG2RAD*i)*Math.cos(THREE.MathUtils.DEG2RAD*n)),e.multiplyScalar(this.data.radius)}},convertWidth:function(t){return this.flat?t*this.data.scaleFactor:t},convertHeight:function(t){const e=t*this.aspectRatio();return this.flat?e*this.data.scaleFactor:e},aspectRatio:function(){return this.flat?this.el.sceneEl.camera.aspect:this.data.horizontalFov/this.data.verticalFov},scale:function(){if(this.flat){const t=this.el.sceneEl.camera;return 2*(Math.tan(.5*THREE.MathUtils.DEG2RAD*t.fov)/t.zoom)*t.aspect*this.data.scaleFactor}return this.data.horizontalFov/360*this.data.radius*Math.PI*2},orientate:function(){const t=new THREE.Matrix4,e=new THREE.Vector3(0,1,0),n=new THREE.Vector3(0,0,0);return function(i,a){this.flat?a.identity():(t.lookAt(n,i,e),a.setFromRotationMatrix(t))}}()});const t={"top-left":new THREE.Vector2(-1,1),top:new THREE.Vector2(0,1),"top-right":new THREE.Vector2(1,1),right:new THREE.Vector2(1,0),"bottom-right":new THREE.Vector2(1,-1),bottom:new THREE.Vector2(0,-1),"bottom-left":new THREE.Vector2(-1,-1),left:new THREE.Vector2(-1,0),center:new THREE.Vector2(0,0)};AFRAME.registerComponent("hud-element",{schema:{align:{type:"string",default:"center"},anchor:{type:"string",default:"center"},contentSize:{type:"vec2",default:new THREE.Vector2(1,1)},hudSize:{type:"number",default:1}},init:function(){this.coordinates=new THREE.Vector2},update:function(){const t=this.el.parentElement.components.hud;t&&this.layout(t)},layout:function(e){const n=this.data.contentSize.y/this.data.contentSize.x,i=this.coordinates.copy(t[this.data.align]),a=t[this.data.anchor];i.x-=a.x*e.convertWidth(this.data.hudSize),i.y-=a.y*e.convertHeight(this.data.hudSize*n),e.convertCoordinates(i,this.el.object3D.position);const o=e.scale()*this.data.hudSize/this.data.contentSize.x;this.el.object3D.scale.set(o,o,o),e.orientate(this.el.object3D.position,this.el.object3D.quaternion)}})}));
