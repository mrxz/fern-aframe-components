!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";let e="\n#include <common>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n\nuniform vec3 coreColor;\nuniform float coreOpacity;\nuniform vec3 rimColor;\nuniform float rimOpacity;\n\nin vec3 vNormal;\n\nvoid main() {\n    float factor = 1.0 - max(0.0, dot(normalize(vNormal), vec3(0.0, 0.0, 1.0)));\n    vec3 color = mix(coreColor, rimColor, factor);\n    gl_FragColor = vec4(color, (factor * rimOpacity) + ((1.0 - factor) * coreOpacity));\n\n    #include <logdepthbuf_fragment>\n    #include <tonemapping_fragment>\n    #include <colorspace_fragment>\n    #include <fog_fragment>\n}";+AFRAME.THREE.REVISION<158&&(e=e.replace(/colorspace_fragment/,"encodings_fragment")),AFRAME.registerSystem("highlight",{callbacks:[],afterCallbacks:[],init:function(){this.sentinel=new THREE.Mesh,this.sentinel.frustumCulled=!1,this.sentinel.material.transparent=!0,this.sentinel.renderOrder=1e3,this.el.object3D.add(this.sentinel),this.sentinel.onAfterRender=(e,t,r)=>{this.callbacks.forEach((n=>n(e,t,r))),this.afterCallbacks.forEach((n=>n(e,t,r)))}},registerCallback:function(e){this.callbacks.push(e)},unregisterCallback:function(e){const t=this.callbacks.indexOf(e);-1!==t&&this.callbacks.splice(t,1)},registerAfterCallback:function(e){this.afterCallbacks.push(e)},unregisterAfterCallback:function(e){const t=this.afterCallbacks.indexOf(e);-1!==t&&this.afterCallbacks.splice(t,1)}});const t="_HIGHLIGHT_ON_BEFORE_RENDER_HOOK_";AFRAME.registerComponent("highlight",{schema:{coreColor:{type:"color",default:"#000000"},coreOpacity:{type:"number",default:0,min:0,max:1},rimColor:{type:"color",default:"#FF0000"},rimOpacity:{type:"number",default:1,min:0,max:1},mode:{type:"string",default:"occlusion"}},modes:{occlusion:{depthFunc:THREE.GreaterDepth,secondRender:!0},visible:{depthFunc:THREE.EqualDepth,secondRender:!1}},init:function(){this.renderCalls=[],this.outlineMaterial=new THREE.ShaderMaterial({vertexShader:"\n#include <common>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n\nout vec3 vNormal;\n\nvoid main() {\n    vNormal = normalMatrix * normal;\n\n    #include <begin_vertex>\n    #include <project_vertex>\n    #include <logdepthbuf_vertex>\n    #include <fog_vertex>\n}",fragmentShader:e,transparent:!0,depthTest:!0,depthFunc:this.modes[this.data.mode].depthFunc,depthWrite:!1,uniforms:{coreColor:{value:new THREE.Color(this.data.coreColor)},coreOpacity:{value:this.data.coreOpacity},rimColor:{value:new THREE.Color(this.data.rimColor)},rimOpacity:{value:this.data.rimOpacity}}});const r=e=>{e.traverse((e=>{if(e.isMesh){if(e.onBeforeRender!==THREE.Object3D.prototype.onBeforeRender&&!e.onBeforeRender[t])return void console.warn("Object already has an onBeforeRender hook! Highlight effect will likely not work for this entity!");const r=(t,r,n,i,o,a)=>{this.renderCalls.push({renderer:t,scene:r,camera:n,geometry:i,material:o,group:a,object:e})};r[t]=!0,e.onBeforeRender=r}}))};r(this.el.object3D),this.el.addEventListener("object3dset",(e=>{r(e.detail.object)})),this.callback=(e,t,r)=>{this.renderCalls.forEach((e=>{const{renderer:t,scene:r,camera:n,geometry:i,material:o,group:a,object:l}=e;t.renderBufferDirect(n,r,i,this.outlineMaterial,l,a),this.modes[this.data.mode].secondRender&&t.renderBufferDirect(n,r,i,o,l,a)})),this.renderCalls.splice(0,this.renderCalls.length)},this.system.registerCallback(this.callback)},update:function(){this.outlineMaterial.uniforms.coreColor.value.set(this.data.coreColor),this.outlineMaterial.uniforms.coreOpacity.value=this.data.coreOpacity,this.outlineMaterial.uniforms.rimColor.value.set(this.data.rimColor),this.outlineMaterial.uniforms.rimOpacity.value=this.data.rimOpacity},remove:function(){this.system.unregisterCallback(this.callback)}}),AFRAME.registerComponent("above-highlight",{init:function(){this.renderCalls=[];const e=e=>{e.traverse((e=>{if(e.isMesh){if(e.onBeforeRender!==THREE.Object3D.prototype.onBeforeRender&&!e.onBeforeRender[t])return void console.warn("Object already has an onBeforeRender hook! Highlight effect will likely not work for this entity!");const r=(t,r,n,i,o,a)=>{this.renderCalls.push({renderer:t,scene:r,camera:n,geometry:i,material:o,group:a,object:e})};r[t]=!0,e.onBeforeRender=r}}))};e(this.el.object3D),this.el.addEventListener("object3dset",(t=>{e(t.detail.object)})),this.callback=(e,t,r)=>{this.renderCalls.forEach((e=>{const{renderer:t,scene:r,camera:n,geometry:i,material:o,group:a,object:l}=e;t.renderBufferDirect(n,r,i,o,l,a)})),this.renderCalls.splice(0,this.renderCalls.length)},this.el.sceneEl.systems.highlight.registerAfterCallback(this.callback)},remove:function(){this.el.sceneEl.systems.highlight.unregisterAfterCallback(this.callback)}})}));
